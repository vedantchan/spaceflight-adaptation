%% 6/25/19 Testing ApEn on shim
% eventually want to test on HRV too!

%6/26/19: just working on subj29; run ApEN on x, y, z acc data, put into file.
%(do we want angular vel too? is ApEn run on acceleration data or other?
%should i filter first? 

clear all;
close;

datafolder = 'C:/Users/Spaceexplorers/Documents/GitHub/spaceflight-adaptation/data';
subj = uipickfile('filterspec',datafolder);
% will allow chosing by subj first to make more general for later

files = ls([subj{1} '/' '*.csv']);
files = sort(files);

trialnames = ["UP1" "UP2" "P1" "P2" "Rec"]';

for f = 1:length(files)
        %just do x,y,z first

        data = importdata([subj{1} '/' files(f,1:end)]);
        t = data(1:end,1);
        x = data(1:end,2);
        %remove the potential outlier (find a better way)
        [mx,ix] = max(x);
        x(ix) = [];
        y = data(1:end,3);
        [my,iy] = max(y);
        y(iy) = [];
        z = data(1:end,4);
        [mz,iz] = max(z);
        z(iz) = [];
        %r vector?

        devx = std(x)*.15;
        devy = std(y)*.15;
        devz = std(z)*.15;

        apenx = approx_entropy(2,devx,x);
        apeny = approx_entropy(2,devy,y);
        apenz = approx_entropy(2,devz,z);
        
        if mod(f,5) == 0
            T = table(trialnames,apenx,apeny,apenz);
            writetable(T,fullfile(subj,[files(f,1:end-4) '
end

